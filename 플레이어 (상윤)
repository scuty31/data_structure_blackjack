#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define MAX_CARD_SIZE 52

//--------------------- 구조체 ---------------------------------


typedef struct cards {
	char pattern[3];
	int num;
}element;

typedef struct decks {	//덱 
	element data[MAX_CARD_SIZE];
	int top;
}deck;

//typedef struct Node { // 이중 연결 리스트를 위한 노드
//	int data;
//	Node* next, * prev;
//} Node ;
//
//typedef struct DLinkedList { // 이중 연결 리스트
//	Node * head;
//	Node * tail;
//	int count;
//}DLinkedList;

 typedef struct player {
	int bet;
	int turn;
} player;

 //--------------------- 구조체 끝 ------------------------------

//---------------------스택관련 함수----------------------------

void init_stack(deck* d) {
	d->top = -1;
}

int is_empty(deck* d) {
	return (d->top == -1);
}

int is_full(deck* d) {
	return (d->top == MAX_CARD_SIZE - 1);
}

void push(deck* d, element card) {
	if (is_full(d)) {
		fprintf(stderr, "스택 포화 에러");
		return;
	}
	else {
		d->data[++(d->top)] = card;
	}
}

element pop(deck* d) {
	if (is_empty(d)) {
		fprintf(stderr, "스택 공백 에러");
		return;
	}
	else {
		return d->data[(d->top)--];
	}
}

//---------------------스택관련 함수 끝-------------------------


//---- 전역변수 ------------------------------------

int player_num;
char shape[4][3] = { "♠", "◆", "♥", "♣" };	//카드 문양

//--------------------------------------------------

//---- 함수 ----------------------------------------

// 초기 시작 화면 몇 명의 CPU와 게임을 할 것인지 리턴
int start() {
	int i = 0;
	char choice1;
	printf("     블랙잭 게임에 오신 것을 환영합니다!     \n");
	printf("            게임을 시작하시겠습니까?         \n");
	printf("                    [Y/N]                      ");

	scanf("%c", &choice1);

	// Y나 N을 누르지 않을경우
	while ((choice1 != 'Y') && (choice1 != 'y') && (choice1 != 'N') && (choice1 != 'n'))
	{
		printf("\n");
		printf("입력이 잘못되었습니다. 다시 입력해주세요 [Y/N].\n");
		scanf("%c", &choice1);
	}

	// Y나 N을 누를 경우
	if (choice1 == 'Y' || choice1 == 'y') {
		printf("\n     CPU PLAYER를 몇 명으로 하시겠습니까?      ");
		printf("\n                CPU PLAYER [1/2/3]             ");
		scanf("%d", &player_num);
		// CPU PLAYER 입력이 올바르지 않을 경우
		while (player_num != 3 && player_num != 2 && player_num != 1) {
			printf("\n숫자 3, 2, 1 중에서 입력해주시기 바랍니다.");
			scanf("%d", &player_num);
		}
		if (player_num == 3 || player_num == 2 || player_num == 1) {
			printf("\n     CPU PLAYER 인원이 총 %d명으로 세팅되었습니다.     ", player_num);
		}
	}
	else if (choice1 == 'N' || choice1 == 'n') {
		printf("             게임을 종료하겠습니다.             \n");
	}

	return player_num;
}

int betting(player * user) {
	user->bet = 100;
	int temp = user->bet;
	int n_bet;
	printf("\n            게임을 시작하겠습니다.           ");
	printf("\n     %d$중에서 얼마를 베팅하시겠습니까?       ", user->bet);
	
	n_bet = 0;
	scanf("%d", &n_bet);

	user->bet = temp - n_bet;
	printf("\n          %d의 금액 배팅 진행하겠습니다.          ", n_bet);
	printf("\n               잔여 배팅 금액: %d               \n", user->bet);
	
	return n_bet;
}

//void play(player_num) {
//	if (player_num == 4) {
//		user_play();
//		dealer_play();
//		player1_play();
//		player2_play();
//		player3_play();
//	}
//	else if (player_num == 3) {
//
//	}
//	else if (player_num == 2) {
//
//	}
//	else if (player_num == 1) {
//
//	}
//	
//}

//카드 출력 함수
void showcard(element card) {	//카드 출력
	if (card.num == 1) {
		printf("-------\n");
		printf("|%s    |\n", card.pattern);
		printf("|  A  |\n");
		printf("|    %s|\n", card.pattern);
		printf("-------\n");
	}
	else if (card.num < 11) {
		printf("-------\n");
		printf("|%s    |\n", card.pattern);
		printf("|  %d  |\n", card.num);
		printf("|    %s|\n", card.pattern);
		printf("-------\n");
	}
	else if (card.num == 11) {
		printf("-------\n");
		printf("|%s    |\n", card.pattern);
		printf("|  J  |\n");
		printf("|    %s|\n", card.pattern);
		printf("-------\n");
	}
	else if (card.num == 12) {
		printf("-------\n");
		printf("|%s    |\n", card.pattern);
		printf("|  Q  |\n");
		printf("|    %s|\n", card.pattern);
		printf("-------\n");
	}
	else if (card.num == 13) {
		printf("-------\n");
		printf("|%s    |\n", card.pattern);
		printf("|  K  |\n");
		printf("|    %s|\n", card.pattern);
		printf("-------\n");
	}
	else {
		fprintf(stderr, "카드 에러");
	}
}

//카드 섞는수 함수
void shakedeak(element* cards) {
	element card;
	int k[52];

	for (int i = 0; i < 52; i++) {
		strcpy(card.pattern, shape[i / 13]);
		card.num = (i % 13) + 1;
		cards[i] = card;
		k[i] = i;
	}	// set cards

	for (int i = 0; i < 300; i++) {
		int x = rand() % 52;
		int y = rand() % 52;
		element tmp;

		if (x != y) {
			tmp.num = cards[x].num;
			strcpy(tmp.pattern, cards[x].pattern);
			cards[x].num = cards[y].num;
			strcpy(cards[x].pattern, cards[y].pattern);
			cards[y].num = tmp.num;
			strcpy(cards[y].pattern, tmp.pattern);
		}
	}
}

//---- 함수 끝 -------------------------------------


int main(void) {
	deck card_deck;
	element cards[52];
	element card;
	player user;
	int i = 0;

	// 스택 초기화했습니다.
	init_stack(&card_deck);

	// 카드를 섞었습니다.
	shakedeak(cards);

	// 덱에다가 카드를 넣었습니다. 덱에 있는 카드들을 배열안에 집어 넣습니다.
	for (i = 0; i < MAX_CARD_SIZE; i++) {
		push(&card_deck, cards[i]);
	}
	// 시작 함수 player수를 리턴해줍니다
	start();

	// 베팅 함수 
	betting(&user);

	//play(player_num);
	//user_play();
	//dealer_play();
	//player1_play();
	//player2_play();
	//player3_play();

	// 플레이어 수에 따라서 카드를 보여주기 위한 코드
	i = 0;
	while (i < player_num +2) {
		card = pop(&card_deck);
		showcard(card);
		printf("\n");
		i++;
	}

	return 0;
}
